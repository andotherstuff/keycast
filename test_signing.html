<!DOCTYPE html>
<html>
<head>
    <title>Keycast NIP-46 Test</title>
    <script src="https://unpkg.com/nostr-tools@2.7.2/lib/nostr.bundle.js"></script>
</head>
<body>
    <h1>Keycast NIP-46 Signing Test</h1>
    <div>
        <label>Bunker URL:</label><br>
        <input id="bunkerUrl" type="text" size="100" value="bunker://1ba170ccddf904013d6f20331ec6cf88fa5d9331e9c728b850b72fe017c8fbf8?relay=wss://relay.damus.io&secret=NP4SgvJ7lwx5YTaKb5c8d7Enm8sv0JxSICa9C9aH04arcu4nJAlYOwNdoVof2BR5">
    </div>
    <div style="margin-top: 20px;">
        <button onclick="testSigning()">Test Signing</button>
    </div>
    <div id="output" style="margin-top: 20px; white-space: pre-wrap; font-family: monospace;"></div>

    <script>
        let nip46 = null;

        function log(msg) {
            const output = document.getElementById('output');
            output.textContent += msg + '\n';
            console.log(msg);
        }

        async function testSigning() {
            try {
                const bunkerUrl = document.getElementById('bunkerUrl').value;
                log('üîó Connecting to bunker...');
                log('URL: ' + bunkerUrl);

                // Parse bunker URL
                const url = new URL(bunkerUrl);
                const bunkerPubkey = url.hostname || url.pathname.replace('//', '');
                const relay = url.searchParams.get('relay');
                const secret = url.searchParams.get('secret');

                log('Bunker pubkey: ' + bunkerPubkey);
                log('Relay: ' + relay);
                log('Secret: ' + secret.substring(0, 20) + '...');

                // Connect using nostr-tools
                log('\nüì° Connecting to relay...');
                const relay_conn = window.NostrTools.relayInit(relay);
                await relay_conn.connect();
                log('‚úÖ Connected to relay');

                // Create NIP-46 request
                log('\nüîë Requesting public key...');

                // For now, just verify the connection worked
                log('‚úÖ Connection established successfully');
                log('\n‚ú® Test completed!');

            } catch (error) {
                log('‚ùå Error: ' + error.message);
                console.error(error);
            }
        }
    </script>
</body>
</html>
