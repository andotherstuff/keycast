---
title: "4:54:30 PM - October 23, 2025"
date: 2025-10-23T03:54:30.775Z
timestamp: 1761191670775
---

## Project Notes

## Keycast Permission System Implementation Plan

### Database Schema (already exists, just needs data)
```sql
-- Already exists:
- oauth_applications (has policy_id)
- oauth_authorizations (has policy_id, max_uses, expires_at)
- policies (collection of permissions)
- permissions (individual permission rules)
- policy_permissions (joins)
- signing_activity (audit log)

-- Need to add:
- Default "keycast-login" policy with sensible permissions
- Seed common permission templates
```

### New API Endpoints Needed
```
GET  /api/user/sessions          - List all active sessions ✅ (exists)
GET  /api/user/sessions/:id/activity - Activity log ✅ (exists) 
POST /api/user/sessions/revoke   - Revoke session ✅ (exists)

NEW:
GET  /api/user/permissions        - Get my default policy permissions
PUT  /api/user/permissions        - Update my default policy
GET  /api/permission-templates    - List available templates
POST /api/sessions/:id/permissions - Update session permissions

OAuth Flow:
GET  /api/oauth/authorize?scope=... - Show permission request UI
POST /api/oauth/authorize - Accept/deny with chosen permissions
```

### Frontend Pages Needed
```
/settings/permissions - Main permissions management
/oauth/authorize - Permission request approval (already exists, needs scope parsing)
```

### Permission Scope Mapping
```rust
// Map OAuth scopes to event kinds
"sign:notes" -> [1]
"sign:profile" -> [0]
"sign:follows" -> [3]
"sign:reactions" -> [7, 9735]
"sign:dms" -> [4, 44]
"sign:zaps" -> [9734]
"sign:lists" -> [10000..=19999]
"sign:all-social" -> [0,1,3,7,9735]
"decrypt:dms" -> NIP-04/NIP-44 decrypt permission
```

### Current Gaps
1. No default policy for "keycast-login" app
2. No scope parameter in OAuth authorize flow
3. No UI for viewing/editing permissions
4. No permission templates in database
5. No scope-to-permission conversion logic

### Implementation Priority
1. Create default "keycast-login" policy on registration
2. Add scope parsing to OAuth flow
3. Build /settings/permissions UI
4. Add permission templates
5. Implement scope-based permission requests

